<!DOCTYPE html>
<html>
  <head>
    <%# --- Titre et Méta-données de base --- %>
    <title><%= meta_title %> DropOne - Partagez et découvrez la musique du moment</title>
    <meta name="description" content="<%= meta_description %>"> <%# <-- Balise de description ajoutée %>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%# --- Open Graph Meta Tags (pour le partage social) --- %>
    <meta property="og:title" content="<%= meta_title %>" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="<%= request.original_url %>" />
    <meta property="og:image" content="<%= meta_image %>" />
    <meta property="og:description" content="<%= meta_description %>" />
    <meta property="og:site_name" content="DropOne" />
    <%# --- Fin des Open Graph Meta Tags --- %>
    <%# --- Favicons et Icônes PWA --- %>
    <%= favicon_link_tag 'favicon.ico' %>
    <%= tag.link rel: "apple-touch-icon", href: image_url("apple-touch-icon.png") %>
    <%# --- Manifeste PWA --- %>
    <%= tag.link rel: "manifest", href: webmanifest_path(format: :json) %>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= render 'shared/ios_pwa_links' %>
    <%# --- Stylesheets --- %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%# --- JavaScript --- %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <%= render "shared/navbar" %>

    <!-- ✅ Zone d'affichage des alertes -->
    <div id="flash-container" class="px-3 flash-container" style="position: fixed; bottom: 1.5rem; left: 0; right: 0; z-index: 1080;">
      <%= render 'shared/flashes' %>
    </div>

    <!-- ✅ Contenu principal -->
    <div class="container d-flex justify-content-center" style="padding-bottom: 100px;">
      <div class="text-center w-100">
        <%= yield %>
      </div>
    </div>

    <!-- ✅ Script pour auto-dismiss + placement dynamique -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Auto-dismiss après 10 secondes
        document.querySelectorAll('.flash-message[data-auto-dismiss="true"]').forEach((el) => {
          setTimeout(() => {
            const bsAlert = bootstrap.Alert.getOrCreateInstance(el);
            bsAlert.close();
          }, 10000);
        });

        // Ajuste la position si navbar_bottom présente
        const flashContainer = document.getElementById("flash-container");
        const bottomNavbar = document.getElementById("bottom-navbar");

        if (flashContainer && bottomNavbar) {
          const navbarHeight = bottomNavbar.offsetHeight;
          flashContainer.style.bottom = `${navbarHeight + 16}px`;
        }
      });
    </script>
  </body>
</html>
